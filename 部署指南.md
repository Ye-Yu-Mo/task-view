# TaskView Docker éƒ¨ç½²æŒ‡å—

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨ä½¿ç”¨Dockeréƒ¨ç½²TaskViewä»»åŠ¡çœ‹æ¿ç®¡ç†ç³»ç»Ÿã€‚

## ğŸ“‹ å‰ç½®è¦æ±‚

- Docker 25.0 æˆ–æ›´é«˜ç‰ˆæœ¬  
- Docker Compose v2.20 æˆ–æ›´é«˜ç‰ˆæœ¬
- 4GB+ å¯ç”¨å†…å­˜ï¼ˆç”¨äºæ„å»ºï¼‰
- 2GB+ ç£ç›˜ç©ºé—´

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šä½¿ç”¨ Docker Composeï¼ˆæ¨èï¼‰

1. **å…‹éš†é¡¹ç›®**
```bash
git clone <repository-url>
cd task-view
```

2. **å¯åŠ¨åº”ç”¨**
```bash
# æ„å»ºå¹¶å¯åŠ¨
docker-compose up -d --build

# æˆ–è€…ä»…å¯åŠ¨ï¼ˆå¦‚æœå·²æ„å»ºï¼‰
docker-compose up -d
```

3. **è®¿é—®åº”ç”¨**
- æ‰“å¼€æµè§ˆå™¨è®¿é—®: `http://localhost:3000`
- å¥åº·æ£€æŸ¥: `http://localhost:3000/health`
- APIæ¥å£: `http://localhost:3000/api`

### æ–¹å¼äºŒï¼šä½¿ç”¨ Docker å‘½ä»¤

1. **æ„å»ºé•œåƒ**
```bash
docker build -t taskview:latest .
```

2. **è¿è¡Œå®¹å™¨**
```bash
docker run -d \
  --name taskview-app \
  -p 3000:80 \
  -v taskview-data:/app/data \
  -e JWT_SECRET="your-secure-jwt-secret" \
  taskview:latest
```

## ğŸ“ æ•°æ®æŒä¹…åŒ–

åº”ç”¨æ•°æ®ï¼ˆåŒ…æ‹¬SQLiteæ•°æ®åº“ï¼‰å­˜å‚¨åœ¨Dockerå·ä¸­ï¼š

- `taskview-data`: å­˜å‚¨åº”ç”¨æ•°æ®åº“æ–‡ä»¶
- `taskview-logs`: å­˜å‚¨Nginxè®¿é—®æ—¥å¿—

### æ•°æ®å¤‡ä»½

```bash
# å¤‡ä»½æ•°æ®
docker run --rm -v taskview-data:/data -v $(pwd):/backup alpine tar czf /backup/taskview-data-backup.tar.gz /data

# æ¢å¤æ•°æ®  
docker run --rm -v taskview-data:/data -v $(pwd):/backup alpine tar xzf /backup/taskview-data-backup.tar.gz -C /
```

## âš™ï¸ ç¯å¢ƒé…ç½®

åœ¨ `docker-compose.yml` æˆ–è¿è¡Œæ—¶è®¾ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

| å˜é‡å | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `JWT_SECRET` | è‡ªåŠ¨ç”Ÿæˆ | JWTç­¾åå¯†é’¥ï¼ˆç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹ï¼‰ |
| `RUST_LOG` | info | æ—¥å¿—çº§åˆ« (trace, debug, info, warn, error) |
| `TZ` | Asia/Shanghai | æ—¶åŒºè®¾ç½® |

### ç”Ÿäº§ç¯å¢ƒé…ç½®ç¤ºä¾‹

```yaml
environment:
  - JWT_SECRET=your-very-secure-32-characters-secret
  - RUST_LOG=warn
  - TZ=Asia/Shanghai
```

## ğŸ”§ ç®¡ç†å‘½ä»¤

### æŸ¥çœ‹æ—¥å¿—
```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
docker-compose logs -f taskview

# æŸ¥çœ‹æ„å»ºæ—¥å¿—
docker-compose logs --no-color taskview > build.log
```

### é‡å¯æœåŠ¡
```bash
# é‡å¯æœåŠ¡
docker-compose restart taskview

# é‡æ–°æ„å»ºå¹¶é‡å¯
docker-compose up -d --build
```

### åœæ­¢æœåŠ¡
```bash
# åœæ­¢æœåŠ¡
docker-compose stop

# åœæ­¢å¹¶åˆ é™¤å®¹å™¨ï¼ˆä¿ç•™æ•°æ®ï¼‰
docker-compose down

# åˆ é™¤æ‰€æœ‰å†…å®¹ï¼ˆåŒ…æ‹¬æ•°æ®ï¼‰
docker-compose down -v
```

## ğŸŒ åå‘ä»£ç†é…ç½®

å¦‚éœ€ä½¿ç”¨åŸŸåè®¿é—®ï¼Œå¯é…ç½®Nginxåå‘ä»£ç†ï¼š

```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://127.0.0.1:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

## ğŸ“Š ç›‘æ§å’Œå¥åº·æ£€æŸ¥

### å¥åº·æ£€æŸ¥ç«¯ç‚¹
- `/health` - åº”ç”¨å¥åº·çŠ¶æ€
- `/api/health` - åç«¯APIå¥åº·çŠ¶æ€

### å®¹å™¨çŠ¶æ€ç›‘æ§
```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹èµ„æºä½¿ç”¨æƒ…å†µ
docker stats taskview-app
```

## ğŸ”’ å®‰å…¨å»ºè®®

1. **ä¿®æ”¹é»˜è®¤JWTå¯†é’¥**
   ```bash
   # ç”Ÿæˆå®‰å…¨çš„JWTå¯†é’¥
   openssl rand -base64 32
   ```

2. **ä½¿ç”¨HTTPS**
   - é…ç½®SSLè¯ä¹¦
   - ä½¿ç”¨Let's Encryptç­‰å…è´¹è¯ä¹¦

3. **é˜²ç«å¢™é…ç½®**
   - ä»…å¼€æ”¾å¿…è¦ç«¯å£
   - é™åˆ¶è®¿é—®æ¥æºIP

4. **å®šæœŸå¤‡ä»½**
   - è®¾ç½®è‡ªåŠ¨å¤‡ä»½è®¡åˆ’
   - æµ‹è¯•æ¢å¤æµç¨‹

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **å®¹å™¨æ— æ³•å¯åŠ¨**
   ```bash
   # æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
   docker-compose logs taskview
   
   # æ£€æŸ¥ç«¯å£å ç”¨
   lsof -i :3000
   ```

2. **å‰ç«¯æ— æ³•è®¿é—®åç«¯API**
   ```bash
   # è¿›å…¥å®¹å™¨æ£€æŸ¥
   docker-compose exec taskview sh
   
   # æµ‹è¯•åç«¯è¿æ¥
   wget -O- http://127.0.0.1:20000/api/health
   ```

3. **æ•°æ®ä¸¢å¤±**
   ```bash
   # æ£€æŸ¥æ•°æ®å·
   docker volume ls
   docker volume inspect taskview-data
   ```

### é‡ç½®åº”ç”¨æ•°æ®
```bash
# è­¦å‘Šï¼šè¿™å°†åˆ é™¤æ‰€æœ‰æ•°æ®ï¼
docker-compose down -v
docker volume rm taskview-data taskview-logs
docker-compose up -d --build
```

## ğŸ“ æ›´æ–°åº”ç”¨

1. **åœæ­¢å½“å‰æœåŠ¡**
   ```bash
   docker-compose down
   ```

2. **æ‹‰å–æœ€æ–°ä»£ç **
   ```bash
   git pull origin main
   ```

3. **é‡æ–°æ„å»ºå¹¶å¯åŠ¨**
   ```bash
   docker-compose up -d --build
   ```

## ğŸ’¡ æ€§èƒ½ä¼˜åŒ–

1. **æ„å»ºç¼“å­˜ä¼˜åŒ–**
   ```bash
   # ä½¿ç”¨BuildKitåŠ é€Ÿæ„å»º
   DOCKER_BUILDKIT=1 docker-compose build
   ```

2. **èµ„æºé™åˆ¶**
   ```yaml
   services:
     taskview:
       deploy:
         resources:
           limits:
             memory: 512M
             cpus: '0.5'
   ```

---

å¦‚é‡åˆ°å…¶ä»–é—®é¢˜ï¼Œè¯·æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£æˆ–æäº¤Issueã€‚